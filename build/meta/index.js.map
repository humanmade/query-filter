{"version":3,"file":"meta/index.js","mappings":"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","sources":["webpack://query-loop-filter/./src/meta/edit.js","webpack://query-loop-filter/./src/store/index.js","webpack://query-loop-filter/external window \"ReactJSXRuntime\"","webpack://query-loop-filter/external window [\"wp\",\"apiFetch\"]","webpack://query-loop-filter/external window [\"wp\",\"blockEditor\"]","webpack://query-loop-filter/external window [\"wp\",\"blocks\"]","webpack://query-loop-filter/external window [\"wp\",\"components\"]","webpack://query-loop-filter/external window [\"wp\",\"coreData\"]","webpack://query-loop-filter/external window [\"wp\",\"data\"]","webpack://query-loop-filter/external window [\"wp\",\"element\"]","webpack://query-loop-filter/external window [\"wp\",\"i18n\"]","webpack://query-loop-filter/webpack/bootstrap","webpack://query-loop-filter/webpack/runtime/compat get default export","webpack://query-loop-filter/webpack/runtime/define property getters","webpack://query-loop-filter/webpack/runtime/hasOwnProperty shorthand","webpack://query-loop-filter/webpack/runtime/make namespace object","webpack://query-loop-filter/./src/meta/index.js"],"sourcesContent":["import { __ } from '@wordpress/i18n';\nimport { useBlockProps, InspectorControls } from '@wordpress/block-editor';\nimport {\n\tPanelBody,\n\tSelectControl,\n\tTextControl,\n\tToggleControl,\n\tSpinner,\n} from '@wordpress/components';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport { useState, useEffect, useMemo } from '@wordpress/element';\n\nexport default function Edit( { attributes, setAttributes, context } ) {\n\tconst { metaKey, emptyLabel, label, showLabel } = attributes;\n\tconst [ metaFieldOptions, setMetaFieldOptions ] = useState( [] );\n\n\t// Get post types from query context\n\tlet contextPostTypes = ( context.query.postType || '' )\n\t\t.split( ',' )\n\t\t.map( ( type ) => type.trim() );\n\n\t// Support for enhanced query loop block plugin.\n\tif ( Array.isArray( context.query.multiple_posts ) ) {\n\t\tcontextPostTypes = contextPostTypes.concat(\n\t\t\tcontext.query.multiple_posts\n\t\t);\n\t}\n\n\t// Fetch a single post for each post type to get meta fields\n\tconst postsData = useSelect(\n\t\tselect => {\n\t\t\tconst { getEntityRecords } = select( coreStore );\n\t\t\tconst data = {};\n\n\t\t\tcontextPostTypes.forEach( postType => {\n\t\t\t\tdata[ postType ] = getEntityRecords( 'postType', postType, {\n\t\t\t\t\tper_page: 1,\n\t\t\t\t\tcontext: 'edit',\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\treturn data;\n\t\t},\n\t\t[ contextPostTypes ]\n\t);\n\n\t// Get meta cardinality and values from the data store\n\tconst { metaCardinalities, metaValues, isLoadingValues } = useSelect(\n\t\tselect => {\n\t\t\tconst metaStore = select( 'query-filter/meta' );\n\t\t\tconst cardinalities = {};\n\n\t\t\t// Get cardinality for all meta keys across all post types\n\t\t\tcontextPostTypes.forEach( postType => {\n\t\t\t\tconst posts = postsData[ postType ];\n\t\t\t\tif ( posts && posts.length > 0 && posts[ 0 ].meta ) {\n\t\t\t\t\tObject.keys( posts[ 0 ].meta ).forEach( key => {\n\t\t\t\t\t\tif ( ! cardinalities[ key ] ) {\n\t\t\t\t\t\t\tcardinalities[ key ] = metaStore?.getMetaCardinality( postType, key );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// Get meta values for selected key\n\t\t\tconst values = metaKey && contextPostTypes.length > 0\n\t\t\t\t? metaStore?.getMetaValues( contextPostTypes, metaKey )\n\t\t\t\t: [];\n\n\t\t\treturn {\n\t\t\t\tmetaCardinalities: cardinalities,\n\t\t\t\tmetaValues: values || [],\n\t\t\t\tisLoadingValues: ! metaKey || values === undefined,\n\t\t\t};\n\t\t},\n\t\t[ contextPostTypes, postsData, metaKey ]\n\t);\n\n\t// Extract meta fields from posts and combine with cardinality\n\tconst allMetaKeys = useMemo( () => {\n\t\tconst metaKeySet = new Set();\n\n\t\tcontextPostTypes.forEach( postType => {\n\t\t\tconst posts = postsData[ postType ];\n\t\t\tif ( posts && posts.length > 0 && posts[ 0 ].meta ) {\n\t\t\t\tObject.keys( posts[ 0 ].meta ).forEach( key => {\n\t\t\t\t\tmetaKeySet.add( key );\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\treturn Array.from( metaKeySet );\n\t}, [ postsData, contextPostTypes ] );\n\n\t// Build field options when meta keys or cardinalities change\n\tuseEffect( () => {\n\t\tconst fields = allMetaKeys.map( key => {\n\t\t\tconst cardinality = metaCardinalities[ key ] || 0;\n\t\t\tconst tooManyValues = cardinality > 50;\n\n\t\t\treturn {\n\t\t\t\tlabel: tooManyValues\n\t\t\t\t\t? `${ key } (too many values)`\n\t\t\t\t\t: key,\n\t\t\t\tvalue: key,\n\t\t\t\tdisabled: tooManyValues,\n\t\t\t\tcardinality,\n\t\t\t};\n\t\t} );\n\n\t\t// Sort fields: enabled first, then by label\n\t\tfields.sort( ( a, b ) => {\n\t\t\tif ( a.disabled !== b.disabled ) {\n\t\t\t\treturn a.disabled ? 1 : -1;\n\t\t\t}\n\t\t\treturn a.label.localeCompare( b.label );\n\t\t} );\n\n\t\tsetMetaFieldOptions( fields );\n\t}, [ allMetaKeys, metaCardinalities ] );\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Meta Field Settings', 'query-filter' ) }>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Select Meta Field', 'query-filter' ) }\n\t\t\t\t\t\tvalue={ metaKey }\n\t\t\t\t\t\toptions={ [\n\t\t\t\t\t\t\t{ label: __( 'Select a field...', 'query-filter' ), value: '' },\n\t\t\t\t\t\t\t...metaFieldOptions,\n\t\t\t\t\t\t] }\n\t\t\t\t\t\tonChange={ ( newMetaKey ) => {\n\t\t\t\t\t\t\tconst selectedField = metaFieldOptions.find(\n\t\t\t\t\t\t\t\t( field ) => field.value === newMetaKey\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\tmetaKey: newMetaKey,\n\t\t\t\t\t\t\t\tlabel: selectedField?.label?.replace( ' (too many values)', '' ) || '',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\tlabel={ __( 'Label', 'query-filter' ) }\n\t\t\t\t\t\tvalue={ label }\n\t\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t\t'If empty then no label will be shown',\n\t\t\t\t\t\t\t'query-filter'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tonChange={ ( newLabel ) => setAttributes( { label: newLabel } ) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Show Label', 'query-filter' ) }\n\t\t\t\t\t\tchecked={ showLabel }\n\t\t\t\t\t\tonChange={ ( newShowLabel ) =>\n\t\t\t\t\t\t\tsetAttributes( { showLabel: newShowLabel } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\tlabel={ __( 'Empty Choice Label', 'query-filter' ) }\n\t\t\t\t\t\tvalue={ emptyLabel }\n\t\t\t\t\t\tplaceholder={ __( 'All', 'query-filter' ) }\n\t\t\t\t\t\tonChange={ ( newEmptyLabel ) =>\n\t\t\t\t\t\t\tsetAttributes( { emptyLabel: newEmptyLabel } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t<div { ...useBlockProps( { className: 'wp-block-query-filter' } ) }>\n\t\t\t\t{ showLabel && label && (\n\t\t\t\t\t<label className=\"wp-block-query-filter-meta__label wp-block-query-filter__label\">\n\t\t\t\t\t\t{ label }\n\t\t\t\t\t</label>\n\t\t\t\t) }\n\t\t\t\t<select\n\t\t\t\t\tclassName=\"wp-block-query-filter-meta__select wp-block-query-filter__select\"\n\t\t\t\t\tinert=\"true\"\n\t\t\t\t>\n\t\t\t\t\t<option>\n\t\t\t\t\t\t{ emptyLabel || __( 'All', 'query-filter' ) }\n\t\t\t\t\t</option>\n\t\t\t\t\t{ isLoadingValues && (\n\t\t\t\t\t\t<option disabled>\n\t\t\t\t\t\t\t<Spinner />{ ' ' }\n\t\t\t\t\t\t\t{ __( 'Loading values...', 'query-filter' ) }\n\t\t\t\t\t\t</option>\n\t\t\t\t\t) }\n\t\t\t\t\t{ ! isLoadingValues &&\n\t\t\t\t\t\tmetaValues.map( ( value, index ) => (\n\t\t\t\t\t\t\t<option key={ index }>{ value }</option>\n\t\t\t\t\t\t) ) }\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</>\n\t);\n}\n","import { createReduxStore, register } from '@wordpress/data';\nimport apiFetch from '@wordpress/api-fetch';\n\nconst DEFAULT_STATE = {\n\tmetaCardinality: {},\n\tmetaValues: {},\n};\n\nconst actions = {\n\tsetMetaCardinality( postType, metaKey, cardinality ) {\n\t\treturn {\n\t\t\ttype: 'SET_META_CARDINALITY',\n\t\t\tpostType,\n\t\t\tmetaKey,\n\t\t\tcardinality,\n\t\t};\n\t},\n\n\tsetMetaValues( postTypes, metaKey, values ) {\n\t\treturn {\n\t\t\ttype: 'SET_META_VALUES',\n\t\t\tpostTypes,\n\t\t\tmetaKey,\n\t\t\tvalues,\n\t\t};\n\t},\n\n\tfetchMetaCardinality( postType, metaKey ) {\n\t\treturn async ( { dispatch } ) => {\n\t\t\ttry {\n\t\t\t\tconst response = await apiFetch( {\n\t\t\t\t\tpath: `/query-filter/v1/meta-cardinality?post_type=${ postType }&meta_key=${ metaKey }`,\n\t\t\t\t} );\n\t\t\t\tconst cardinality = response?.cardinality || 0;\n\t\t\t\tdispatch.setMetaCardinality( postType, metaKey, cardinality );\n\t\t\t\treturn cardinality;\n\t\t\t} catch ( error ) {\n\t\t\t\t// Assume too many if error\n\t\t\t\tdispatch.setMetaCardinality( postType, metaKey, 999 );\n\t\t\t\treturn 999;\n\t\t\t}\n\t\t};\n\t},\n\n\tfetchMetaValues( postTypes, metaKey ) {\n\t\treturn async ( { dispatch } ) => {\n\t\t\ttry {\n\t\t\t\tconst response = await apiFetch( {\n\t\t\t\t\tpath: `/query-filter/v1/meta-values?post_type=${ postTypes.join( ',' ) }&meta_key=${ metaKey }`,\n\t\t\t\t} );\n\t\t\t\tconst values = response?.values || [];\n\t\t\t\tdispatch.setMetaValues( postTypes, metaKey, values );\n\t\t\t\treturn values;\n\t\t\t} catch ( error ) {\n\t\t\t\tdispatch.setMetaValues( postTypes, metaKey, [] );\n\t\t\t\treturn [];\n\t\t\t}\n\t\t};\n\t},\n};\n\nconst selectors = {\n\tgetMetaCardinality( state, postType, metaKey ) {\n\t\tconst key = `${ postType }_${ metaKey }`;\n\t\treturn state.metaCardinality[ key ];\n\t},\n\n\tgetMetaValues( state, postTypes, metaKey ) {\n\t\tconst key = `${ postTypes.join( '_' ) }_${ metaKey }`;\n\t\treturn state.metaValues[ key ];\n\t},\n};\n\nconst reducer = ( state = DEFAULT_STATE, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'SET_META_CARDINALITY': {\n\t\t\tconst key = `${ action.postType }_${ action.metaKey }`;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tmetaCardinality: {\n\t\t\t\t\t...state.metaCardinality,\n\t\t\t\t\t[ key ]: action.cardinality,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tcase 'SET_META_VALUES': {\n\t\t\tconst key = `${ action.postTypes.join( '_' ) }_${ action.metaKey }`;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tmetaValues: {\n\t\t\t\t\t...state.metaValues,\n\t\t\t\t\t[ key ]: action.values,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst resolvers = {\n\t*getMetaCardinality( postType, metaKey ) {\n\t\tconst cardinality = yield actions.fetchMetaCardinality( postType, metaKey );\n\t\treturn cardinality;\n\t},\n\n\t*getMetaValues( postTypes, metaKey ) {\n\t\tconst values = yield actions.fetchMetaValues( postTypes, metaKey );\n\t\treturn values;\n\t},\n};\n\nconst store = createReduxStore( 'query-filter/meta', {\n\treducer,\n\tactions,\n\tselectors,\n\tresolvers,\n} );\n\nregister( store );\n\nexport default store;\n","module.exports = window[\"ReactJSXRuntime\"];","module.exports = window[\"wp\"][\"apiFetch\"];","module.exports = window[\"wp\"][\"blockEditor\"];","module.exports = window[\"wp\"][\"blocks\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"coreData\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"i18n\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { registerBlockType } from '@wordpress/blocks';\nimport Edit from './edit';\nimport '../store';\n\nregisterBlockType( 'query-filter/meta', {\n\tedit: Edit,\n} );\n"],"names":["__","useBlockProps","InspectorControls","PanelBody","SelectControl","TextControl","ToggleControl","Spinner","store","coreStore","useSelect","useState","useEffect","useMemo","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Edit","attributes","setAttributes","context","metaKey","emptyLabel","label","showLabel","metaFieldOptions","setMetaFieldOptions","contextPostTypes","query","postType","split","map","type","trim","Array","isArray","multiple_posts","concat","postsData","select","getEntityRecords","data","forEach","per_page","metaCardinalities","metaValues","isLoadingValues","metaStore","cardinalities","posts","length","meta","Object","keys","key","getMetaCardinality","values","getMetaValues","undefined","allMetaKeys","metaKeySet","Set","add","from","fields","cardinality","tooManyValues","value","disabled","sort","a","b","localeCompare","children","title","options","onChange","newMetaKey","selectedField","find","field","replace","help","newLabel","checked","newShowLabel","placeholder","newEmptyLabel","className","inert","index","createReduxStore","register","apiFetch","DEFAULT_STATE","metaCardinality","actions","setMetaCardinality","setMetaValues","postTypes","fetchMetaCardinality","dispatch","response","path","error","fetchMetaValues","join","selectors","state","reducer","action","resolvers","registerBlockType","edit"],"sourceRoot":""}