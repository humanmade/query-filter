(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"UU":"query-filter/taxonomy-text"}'),l=window.wp.i18n,r=window.wp.blockEditor,i=window.wp.components,a=window.ReactJSXRuntime,o=[{label:(0,l.__)("Tag","query-filter"),value:"tag"},{label:(0,l.__)("Category","query-filter"),value:"category"},{label:(0,l.__)("Sort","query-filter"),value:"sort"},{label:(0,l.__)("Page Number","query-filter"),value:"page"}],s=[{label:(0,l.__)("Title","query-filter"),value:"title"},{label:(0,l.__)("Description","query-filter"),value:"description"},{label:(0,l.__)("Page Number","query-filter"),value:"page"}],n=window.wp.richText,u=window.wp.primitives;var f=(0,a.jsx)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(u.Path,{d:"M17.5 4v5a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V4H8v5a.5.5 0 0 0 .5.5h7A.5.5 0 0 0 16 9V4h1.5Zm0 16v-5a2 2 0 0 0-2-2h-7a2 2 0 0 0-2 2v5H8v-5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v5h1.5Z"})});const y=window.wp.element,p="query-filter/taxonomy-inline-text",c="data-query-filter-text",x={filterType:"tag",valueType:"title",prefix:"",suffix:"",showAfterFirstPage:!0},_=[{label:(0,l.__)("Tag","query-filter"),value:"tag"},{label:(0,l.__)("Category","query-filter"),value:"category"},{label:(0,l.__)("Sort","query-filter"),value:"sort"},{label:(0,l.__)("Page Number","query-filter"),value:"page"}],g=[{label:(0,l.__)("Title","query-filter"),value:"title"},{label:(0,l.__)("Description","query-filter"),value:"description"},{label:(0,l.__)("Page Number","query-filter"),value:"page"}],T=(e,t)=>e.find((e=>e.value===t))?.label||t;(0,n.registerFormatType)(p,{title:(0,l.__)("Taxonomy Text","query-filter"),tagName:"span",className:"taxonomy-text-inline",attributes:{[c]:c},edit:({value:e,onChange:t,isActive:o,activeAttributes:s})=>{const u=(0,y.useMemo)((()=>(e=>{if(!e)return x;try{var t;const l=JSON.parse(e);return{filterType:l.filterType||x.filterType,valueType:l.valueType||x.valueType,prefix:l.prefix||"",suffix:l.suffix||"",showAfterFirstPage:null!==(t=l.showAfterFirstPage)&&void 0!==t?t:x.showAfterFirstPage}}catch(e){return x}})(s?.[c])),[s?.[c]]),[v,d]=(0,y.useState)(!1),[h,w]=(0,y.useState)(u);return(0,y.useEffect)((()=>{w(u)}),[u]),(0,y.useEffect)((()=>{["sort","page"].includes(h.filterType)&&"description"===h.valueType&&w((e=>({...e,valueType:"title"})))}),[h.filterType,h.valueType]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.RichTextToolbarButton,{icon:f,title:(0,l.__)("Taxonomy Text","query-filter"),onClick:()=>d(!0),isActive:o}),v&&(0,a.jsxs)(i.Modal,{title:(0,l.__)("Dynamic Taxonomy Text","query-filter"),onRequestClose:()=>d(!1),children:[(0,a.jsx)(i.SelectControl,{label:(0,l.__)("Filter Source","query-filter"),value:h.filterType,options:_,onChange:e=>{w((t=>({...t,filterType:e,valueType:"page"===e?"page":["sort","page"].includes(e)&&"description"===t.valueType?"title":t.valueType})))}}),(0,a.jsx)(i.SelectControl,{label:(0,l.__)("Value Type","query-filter"),value:h.valueType,options:g,disabled:("sort"===h.filterType||"page"===h.filterType)&&"description"===h.valueType,onChange:e=>w((t=>({...t,valueType:e})))}),(0,a.jsx)(i.TextControl,{label:(0,l.__)("Prefix Text","query-filter"),value:h.prefix,onChange:e=>w((t=>({...t,prefix:e})))}),(0,a.jsx)(i.TextControl,{label:(0,l.__)("Suffix Text","query-filter"),value:h.suffix,onChange:e=>w((t=>({...t,suffix:e})))}),"page"===h.filterType&&(0,a.jsx)(i.ToggleControl,{label:(0,l.__)("Only show after page 1","query-filter"),checked:!!h.showAfterFirstPage,onChange:e=>w((t=>({...t,showAfterFirstPage:e})))}),(0,a.jsx)(i.Flex,{justify:"flex-start",children:(0,a.jsx)(i.FlexItem,{children:(0,a.jsx)(i.Button,{variant:"primary",onClick:()=>{const r={[c]:JSON.stringify(h)},i=e.start===e.end;let a=e;if(i&&!o){const e=(e=>{const t=[(0,l.__)("taxonomy","query-filter"),T(_,e.filterType).toLowerCase()],r="sort"===e.filterType&&"page"!==e.valueType?(0,l.__)("title","query-filter"):T(g,e.valueType);return t.push(r.toLowerCase()),t.join(" ")})(h);a=(0,n.insert)(a,e);const t=a.start,r=t-e.length;a={...a,start:r,end:t}}const s=(0,n.applyFormat)(a,{type:p,attributes:r});t(s),d(!1)},children:(0,l.__)("Apply","query-filter")})})})]})]})}}),(0,e.registerBlockType)(t.UU,{edit:function({attributes:e,setAttributes:t}){const{filterType:n="tag",valueType:u="title",prefix:f="",suffix:y="",showAfterFirstPage:p=!0}=e,c=(0,r.useBlockProps)({className:`taxonomy-text taxonomy-text--${n}`}),x="sort"===n?(0,l.__)("Selected Sort","query-filter"):"description"===u?(0,l.__)("Selected Term Description","query-filter"):(0,l.__)("Selected Term","query-filter");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.InspectorControls,{children:(0,a.jsxs)(i.PanelBody,{title:(0,l.__)("Display Settings","query-filter"),children:[(0,a.jsx)(i.SelectControl,{label:(0,l.__)("Filter Source","query-filter"),value:n,options:o,onChange:e=>{t({filterType:e,valueType:["sort","page"].includes(e)&&"description"===u?"title":u})}}),(0,a.jsx)(i.SelectControl,{label:(0,l.__)("Value Type","query-filter"),value:u,options:s,disabled:("sort"===n||"page"===n)&&"description"===u,onChange:e=>t({valueType:e})}),"page"===n&&(0,a.jsx)(ToggleControl,{label:(0,l.__)("Only show after page 1","query-filter"),checked:!!p,onChange:e=>t({showAfterFirstPage:e})}),(0,a.jsx)(i.TextControl,{label:(0,l.__)("Prefix Text","query-filter"),value:f,onChange:e=>t({prefix:e}),placeholder:(0,l.__)("e.g. Showing results for ","query-filter")}),(0,a.jsx)(i.TextControl,{label:(0,l.__)("Suffix Text","query-filter"),value:y,onChange:e=>t({suffix:e}),placeholder:(0,l.__)("e.g. only","query-filter")})]})}),(0,a.jsx)("span",{...c,children:`${f||""}${x}${y||""}`})]})}})})();